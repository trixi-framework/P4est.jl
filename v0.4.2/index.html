<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · P4est.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://trixi-framework.github.io/P4est.jl/stable/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>P4est.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Authors"><span>Authors</span></a></li><li><a class="tocitem" href="#License-and-contributing"><span>License and contributing</span></a></li></ul></li><li><a class="tocitem" href="introduction/">Introduction</a></li><li><a class="tocitem" href="reference/">API reference</a></li><li><a class="tocitem" href="authors/">Authors</a></li><li><a class="tocitem" href="contributing/">Contributing</a></li><li><a class="tocitem" href="license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/trixi-framework/P4est.jl/blob/main/README.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="P4est.jl"><a class="docs-heading-anchor" href="#P4est.jl">P4est.jl</a><a id="P4est.jl-1"></a><a class="docs-heading-anchor-permalink" href="#P4est.jl" title="Permalink"></a></h1><p><a href="https://trixi-framework.github.io/P4est.jl/stable"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="Docs-stable"/></a> <a href="https://github.com/trixi-framework/P4est.jl/actions?query=workflow%3ACI"><img src="https://github.com/trixi-framework/P4est.jl/workflows/CI/badge.svg" alt="Build Status"/></a> <a href="https://codecov.io/gh/trixi-framework/P4est.jl"><img src="https://codecov.io/gh/trixi-framework/P4est.jl/branch/main/graph/badge.svg" alt="Codecov"/></a> <a href="https://coveralls.io/github/trixi-framework/P4est.jl?branch=main"><img src="https://coveralls.io/repos/github/trixi-framework/P4est.jl/badge.svg?branch=main" alt="Coveralls"/></a> <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-success.svg" alt="License: MIT"/></a></p><p><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> is a Julia package that wraps <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>, a C library to manage multiple connected adaptive quadtrees or octrees in parallel.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>If you have not yet installed Julia, please <a href="https://julialang.org/downloads/platform/">follow the instructions for your operating system</a>. <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> works with Julia v1.6 and later.</p><p><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> is a registered Julia package. Hence, you can install it by executing the following commands in the Julia REPL:</p><pre><code class="language-julia hljs">julia&gt; import Pkg; Pkg.add([&quot;P4est&quot;, &quot;MPI&quot;])</code></pre><p>With this command, you install both <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> and <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a>. Currently, <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> supports only builds of the C library <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> with MPI support, so you need to initialize MPI appropriately as described in the <a href="#Usage">Usage</a> section below.</p><p><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> depends on the binary distribution of the <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> library, which is available in the Julia package P4est_jll.jl and which is automatically installed as a dependency. The binaries provided by P4est_jll.jl support MPI and are compiled against the default MPI binaries of MPI.jl. At the time of writing, these are the binaries provided by MicrosoftMPI_jll.jl on Windows and MPICH_jll.jl on all other platforms.</p><p>By default, <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> provides pre-generated Julia bindings to all exported C functions of the underlying <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> library. If you want/need to generate new bindings, please follow the instructions in the <code>dev</code> folder and copy the generated files to the appropriate places in <code>src</code>.</p><h3 id="Using-a-custom-version-of-MPI-and/or-p4est"><a class="docs-heading-anchor" href="#Using-a-custom-version-of-MPI-and/or-p4est">Using a custom version of MPI and/or <code>p4est</code></a><a id="Using-a-custom-version-of-MPI-and/or-p4est-1"></a><a class="docs-heading-anchor-permalink" href="#Using-a-custom-version-of-MPI-and/or-p4est" title="Permalink"></a></h3><p>The C library <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> needs to be compiled against the same MPI implementation used by <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a>. Thus, if you want to configure <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> to not use the default MPI binary provided by JLL wrappers, you also need to build the C library <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> locally using the same MPI implementation. This is typically the situation on HPC clusters. If you are just using a single workstation, the default installation instructions should be sufficient.</p><p><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> allows using a <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> binary different from the default one provided by P4est_jll.jl. To enable this, you first need to obtain a local binary installation of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>. Next, you need to configure <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> to use the same MPI implementation used to build your local installation of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>, see <a href="https://juliaparallel.org/MPI.jl/stable/configuration/">the documentation of MPI.jl</a>. At the time of writing, this can be done via</p><pre><code class="language-julia hljs">julia&gt; using MPIPreferences

julia&gt; MPIPreferences.use_system_binary()</code></pre><p>if you use the default system MPI binary installation to build <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>.</p><p>Next, you need to set up the <a href="https://github.com/JuliaPackaging/Preferences.jl">Preferences.jl</a> setting containing the path to your local build of the shared library of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>.</p><pre><code class="language-julia hljs">julia&gt; using Preferences, UUIDs

julia&gt; set_preferences!(
           UUID(&quot;7d669430-f675-4ae7-b43e-fab78ec5a902&quot;), # UUID of P4est.jl
           &quot;libp4est&quot; =&gt; &quot;/path/to/your/libp4est.so&quot;, force = true)</code></pre><p>Note that you should restart your Julia session after changing the preferences. To sum up, follow these steps to use <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> with a custom installation of the underlying C libraries.</p><ul><li><p>Create a Julia project for your setup.</p><pre><code class="language-julia hljs">julia&gt; import Pkg; Pkg.activate(&quot;.&quot;)</code></pre><p>This uses the Julia project in your current working directory or creates a new one if there is none.</p></li><li><p>Install the required packages.</p><pre><code class="language-julia hljs">julia&gt; Pkg.add([&quot;MPIPreferences&quot;, &quot;MPI&quot;, &quot;UUIDs&quot;, &quot;Preferences&quot;, &quot;P4est&quot;])</code></pre></li><li><p>Set <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> preferences.</p><pre><code class="language-julia hljs">julia&gt; using MPIPreferences

julia&gt; MPIPreferences.use_system_binary()</code></pre></li><li><p>Set <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> preferences.</p><pre><code class="language-julia hljs">julia&gt; using Preferences, UUIDs

julia&gt; set_preferences!(
           UUID(&quot;7d669430-f675-4ae7-b43e-fab78ec5a902&quot;), # UUID of P4est.jl
           &quot;libp4est&quot; =&gt; &quot;/path/to/your/libp4est.so&quot;, force = true)</code></pre></li><li><p>Restart the Julia REPL and load the packages.</p><pre><code class="language-julia hljs">julia&gt; import Pkg; Pkg.activate(&quot;.&quot;)

julia&gt; using P4est, MPI; MPI.Init()</code></pre></li></ul><p>Currently, custom builds of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> without MPI support are not supported.</p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><p>The <code>P4est.uses_mpi()</code> function can be used to check if the <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> binaries that <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> uses were compiled with MPI enabled. This returns <code>true</code> for the default binaries provided by the P4est_jll.jl package. In this case <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> can be used as follows.</p><p>In the Julia REPL, first load the packages <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> and <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a> in any order and initialize MPI.</p><pre><code class="language-julia hljs">julia&gt; using P4est, MPI; MPI.Init()</code></pre><p>You can then access the full <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> API that is defined by the headers. For example, to create a periodic connectivity and check its validity, execute the following lines:</p><pre><code class="language-julia hljs">julia&gt; using P4est, MPI; MPI.Init()

julia&gt; connectivity = p4est_connectivity_new_periodic()
Ptr{p4est_connectivity} @0x0000000002412d20

julia&gt; p4est_connectivity_is_valid(connectivity)
1

julia&gt; p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 2, 0, 0, C_NULL, C_NULL)
Into p4est_new with min quadrants 0 level 2 uniform 0
New p4est with 1 trees on 1 processors
Initial level 2 potential global quadrants 16 per tree 16
Done p4est_new with 10 total quadrants
Ptr{p4est} @0x0000000002dd1fd0

julia&gt; p4est_obj = unsafe_load(p4est)
P4est.LibP4est.p4est(1140850688, 1, 0, 0, 0x0000000000000000, Ptr{Nothing} @0x0000000000000000, 0, 0, 0, 10, 10, Ptr{Int64} @0x00000000021a5f70, Ptr{p4est_quadrant} @0x0000000002274330, Ptr{p4est_connectivity} @0x000000000255cdf0, Ptr{sc_array} @0x00000000023b64a0, Ptr{sc_mempool} @0x0000000000000000, Ptr{sc_mempool} @0x00000000023b1620, Ptr{p4est_inspect} @0x0000000000000000)

julia&gt; p4est_obj.connectivity == connectivity
true

julia&gt; connectivity_obj = unsafe_load(p4est_obj.connectivity)
p4est_connectivity(4, 1, 1, Ptr{Float64} @0x00000000021e8170, Ptr{Int32} @0x00000000020d2450, 0x0000000000000000, Cstring(0x0000000000000000), Ptr{Int32} @0x0000000002468e10, Ptr{Int8} @0x00000000022035e0, Ptr{Int32} @0x0000000002667230, Ptr{Int32} @0x000000000219eea0, Ptr{Int32} @0x000000000279ae00, Ptr{Int8} @0x00000000021ff910)

julia&gt; connectivity_obj.num_trees
1

julia&gt; p4est_destroy(p4est)

julia&gt; p4est_connectivity_destroy(connectivity)</code></pre><p>As shown here, <code>unsafe_load</code> allows to convert pointers to <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> C <code>struct</code>s to the corresponding Julia wrapper type generated by <a href="https://github.com/JuliaInterop/Clang.jl">Clang.jl</a>. They follow the basic <a href="https://docs.julialang.org/en/v1/manual/calling-c-and-fortran-code/">C interface of Julia</a>.</p><p>If you start Julia on multiple MPI ranks, you can check whether everything is set up correctly by the following extended smoke test. Copy the following code to a local file:</p><pre><code class="language-julia hljs">using P4est, MPI; MPI.Init()
connectivity = p4est_connectivity_new_periodic()
p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 2, 0, 0, C_NULL, C_NULL)
p4est_obj = unsafe_load(p4est)
MPI.Barrier(MPI.COMM_WORLD)
rank = MPI.Comm_rank(MPI.COMM_WORLD)
@info &quot;Setup&quot; rank p4est_obj.local_num_quadrants p4est_obj.global_num_quadrants
p4est_destroy(p4est)
p4est_connectivity_destroy(connectivity)</code></pre><p>Run Julia with the MPI implementation used by MPI.jl and execute the script shown above. You should get an output like</p><pre><code class="nohighlight hljs">Into p4est_new with min quadrants 0 level 2 uniform 0
New p4est with 1 trees on 2 processors
Initial level 2 potential global quadrants 16 per tree 16
Into p4est_new with min quadrants 0 level 2 uniform 0
New p4est with 1 trees on 2 processors
Initial level 2 potential global quadrants 16 per tree 16
Done p4est_new with 13 total quadrants
Done p4est_new with 13 total quadrants
┌ Info: Setup
│   rank = 0
│   p4est_obj.local_num_quadrants = 5
└   p4est_obj.global_num_quadrants = 13
┌ Info: Setup
│   rank = 1
│   p4est_obj.local_num_quadrants = 8
└   p4est_obj.global_num_quadrants = 13</code></pre><p>To suppress the relatively verbose output of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> in the example above, you can call <code>P4est.init(C_NULL, SC_LP_ERROR)</code> before calling other functions from <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>.</p><p>Many functions and types in <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> have been documented with comments by the <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> authors; you can access this documentation as you would for any Julia-native entity through <code>?</code>:</p><pre><code class="nohighlight hljs">help?&gt; p4est_memory_used
search: p4est_memory_used p4est_mesh_memory_used p4est_ghost_memory_used p4est_connectivity_memory_used

  p4est_memory_used(p4est_)

  Calculate local memory usage of a forest structure. Not collective. The memory used on the current rank is
  returned. The connectivity structure is not counted since it is not owned; use
  p4est_connectivity_memory_usage (p4est-&gt;connectivity).

  Parameters
  ––––––––––––

    •  p4est:[in] Valid forest structure.

  Returns
  –––––––––

  Memory used in bytes.

  Prototype
  –––––––––––

  size_t p4est_memory_used (p4est_t * p4est);</code></pre><p>The same is of course true for the higher-level interface functions provided by <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a>, e.g.,</p><pre><code class="nohighlight hljs">help?&gt; P4est.init
  P4est.init(log_handler, log_threshold)

  Calls p4est_init if it has not already been called, otherwise do nothing. Thus, P4est.init can safely be
  called multiple times.

  To use the default log handler and suppress most output created by default by p4est, call this function as

  P4est.init(C_NULL, SC_LP_ERROR)

  before calling other functions from p4est.</code></pre><p>For more information on how to use <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>, please refer to the <a href="http://www.p4est.org/">documentation for p4est itself</a> or to the header files (<code>*.h</code>) in the <a href="https://github.com/cburstedde/p4est/tree/master/src"><code>p4est</code> repository</a>.</p><p>For more information on how to use the Julia wrapper <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a>, please consult the <a href="https://trixi-framework.github.io/P4est.jl/stable">documentation</a>.</p><h2 id="Authors"><a class="docs-heading-anchor" href="#Authors">Authors</a><a id="Authors-1"></a><a class="docs-heading-anchor-permalink" href="#Authors" title="Permalink"></a></h2><p>P4est.jl is mainly maintained by <a href="https://lakemper.eu">Michael Schlottke-Lakemper</a> (RWTH Aachen University, Germany) and <a href="https://ranocha.de">Hendrik Ranocha</a> (University of Hamburg, Germany). The full list of contributors can be found in <a href="authors/#authors_separate_page">Authors</a>. The <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> library itself is written by Carsten Burstedde, Lucas C. Wilcox, and Tobin Isaac.</p><h2 id="License-and-contributing"><a class="docs-heading-anchor" href="#License-and-contributing">License and contributing</a><a id="License-and-contributing-1"></a><a class="docs-heading-anchor-permalink" href="#License-and-contributing" title="Permalink"></a></h2><p>P4est.jl is licensed under the MIT license (see <a href="license/#License">License</a>). <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> itself is licensed under the GNU General Public License, version 2.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="introduction/">Introduction »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 15 March 2023 16:05">Wednesday 15 March 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
