<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Introduction · P4est.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://trixi-framework.github.io/P4est.jl/stable/introduction/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">P4est.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Introduction</a><ul class="internal"><li><a class="tocitem" href="#High-level-overview-of-the-setup"><span>High-level overview of the setup</span></a></li><li><a class="tocitem" href="#translation_guidelines"><span>Translation guidelines</span></a></li><li><a class="tocitem" href="#pointer_wrappers"><span><code>PointerWrapper</code>s</span></a></li></ul></li><li><a class="tocitem" href="../reference/">API reference</a></li><li><a class="tocitem" href="../authors/">Authors</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Introduction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Introduction</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/trixi-framework/P4est.jl/blob/main/docs/src/introduction.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h1><p>Installation instructions and first usage examples are shown on the <a href="../#P4est.jl">main page</a>. This page collects some additional examples and translation guidelines from the C library <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> to its Julia wrapper <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a>.</p><h2 id="High-level-overview-of-the-setup"><a class="docs-heading-anchor" href="#High-level-overview-of-the-setup">High-level overview of the setup</a><a id="High-level-overview-of-the-setup-1"></a><a class="docs-heading-anchor-permalink" href="#High-level-overview-of-the-setup" title="Permalink"></a></h2><p>The Julia bindings of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> are generated using <a href="https://github.com/JuliaInterop/Clang.jl">Clang.jl</a>. This process is described in the <a href="https://github.com/trixi-framework/P4est.jl/tree/main/dev"><code>dev</code></a> folder of <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a>. Since all MPI datatypes are mapped to types from MPI.jl, the generated bindings are agnostic of the local MPI installation. Hence, there should be no need to generate new bindings as a user. If there are problems, please let us know, e.g., by <a href="https://github.com/trixi-framework/P4est.jl/issues/new">creating on issue</a> on GitHub. New bindings only need to be generated for a new version of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> that comes with a different API. We will probably provide some new bindings when we learn about this.</p><h2 id="translation_guidelines"><a class="docs-heading-anchor" href="#translation_guidelines">Translation guidelines</a><a id="translation_guidelines-1"></a><a class="docs-heading-anchor-permalink" href="#translation_guidelines" title="Permalink"></a></h2><p>Many functions of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> work with pointers, e.g.,</p><pre><code class="language-C hljs">int p4est_connectivity_is_valid (p4est_connectivity_t * connectivity);</code></pre><p>or return pointers to newly created <code>struct</code>s, e.g.,</p><pre><code class="language-C hljs">p4est_connectivity_t *p4est_connectivity_new_periodic (void);</code></pre><p><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> wraps these C functions accordingly and works with pointers. For a convenient alternative to using raw pointers directly, see the next section on <a href="#pointer_wrappers"><code>PointerWrapper</code>s</a>. We also follow the naming scheme of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>. For example, we use <code>connectivity::Ptr{p4est_connectivity}</code>. However, it is sometimes useful/required to also load the wrappers of the C <code>struct</code>s from their pointers. In this case, we use the naming convention to append <code>_obj</code>, e.g., <code>connectivity_obj = unsafe_load(connectivity)</code>. A full example is given here:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using P4est, MPI; MPI.Init()</code><code class="nohighlight hljs ansi" style="display:block;">MPI.ThreadLevel(2)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity = p4est_connectivity_new_periodic()</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{p4est_connectivity} @0x0000000005300610</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @doc(p4est_connectivity)</code><code class="nohighlight hljs ansi" style="display:block;">  p4est_connectivity

  This structure holds the 2D inter-tree connectivity information.
  Identification of arbitrary faces and corners is possible.

  The arrays tree_to_* are stored in z ordering. For corners the order wrt. yx
  is 00 01 10 11. For faces the order is -x +x -y +y. They are allocated
  [0][0]..[0][3]..[num_trees-1][0]..[num_trees-1][3].

  The values for tree_to_face are 0..7 where ttf % 4 gives the face number and
  ttf / 4 the face orientation code. The orientation is 0 for edges that are
  aligned in z-order, and 1 for edges that are running opposite in z-order.

  It is valid to specify num_vertices as 0. In this case vertices and
  tree_to_vertex are set to NULL. Otherwise the vertex coordinates are stored
  in the array vertices as
  [0][0]..[0][2]..[num_vertices-1][0]..[num_vertices-1][2].

  The corners are only stored when they connect trees. In this case
  tree_to_corner indexes into ctt_offset. Otherwise the tree_to_corner entry
  must be -1 and this corner is ignored. If num_corners == 0, tree_to_corner
  and corner_to_* arrays are set to NULL.

  The arrays corner_to_* store a variable number of entries per corner. For
  corner c these are at position [ctt_offset[c]]..[ctt_offset[c+1]-1]. Their
  number for corner c is ctt_offset[c+1] - ctt_offset[c]. The entries encode
  all trees adjacent to corner c. The size of the corner_to_* arrays is
  num_ctt = ctt_offset[num_corners].

  The *_to_attr arrays may have arbitrary contents defined by the user.

  Field            Note
  –––––––––––––––– –––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
  num_vertices     the number of vertices that define the embedding of the forest (not the topology)
  num_trees        the number of trees
  num_corners      the number of corners that help define topology
  vertices         an array of size (3 * num_vertices)
  tree_to_vertex   embed each tree into c++ R^3 for e.g. visualization (see p4est_vtk.h)
  tree_attr_bytes  bytes per tree in tree_to_attr
  tree_to_attr     not touched by p4est
  tree_to_tree     (4 * num_trees) neighbors across faces
  tree_to_face     (4 * num_trees) face to face+orientation (see description)
  tree_to_corner   (4 * num_trees) or NULL (see description)
  ctt_offset       corner to offset in cornertotree and cornertocorner
  corner_to_tree   list of trees that meet at a corner
  corner_to_corner list of tree-corners that meet at a corner</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_obj = unsafe_load(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;">p4est_connectivity(4, 1, 1, Ptr{Float64} @0x0000000004842290, Ptr{Int32} @0x00000000044ab3a0, 0x0000000000000000, Cstring(0x0000000000000000), Ptr{Int32} @0x000000000479eb90, Ptr{Int8} @0x00000000044ab370, Ptr{Int32} @0x00000000046ef470, Ptr{Int32} @0x0000000004605590, Ptr{Int32} @0x0000000004fec620, Ptr{Int8} @0x00000000046055c0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_obj.num_vertices</code><code class="nohighlight hljs ansi" style="display:block;">4</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_obj.num_trees</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_obj.num_corners</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_connectivity_destroy(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h2 id="pointer_wrappers"><a class="docs-heading-anchor" href="#pointer_wrappers"><code>PointerWrapper</code>s</a><a id="pointer_wrappers-1"></a><a class="docs-heading-anchor-permalink" href="#pointer_wrappers" title="Permalink"></a></h2><p>As we have seen in the previous section on <a href="#translation_guidelines">translation guidelines</a>, many functions provided by <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> return pointers to <code>struct</code>s, which requires one to <a href="https://docs.julialang.org/en/v1/base/c/#Base.unsafe_load"><code>unsafe_load</code></a> the pointer in order to access the underlying data. <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> offers a convenient alternative to directly using <code>unsafe_load</code> by providing the <a href="../reference/#P4est.PointerWrappers.PointerWrapper"><code>PointerWrapper</code></a> data type. If you, e.g., have a pointer to a <code>p4est_connectivity</code> (i.e., an object of type <code>Ptr{p4est_connectivity}</code>) called <code>connectivity</code>, you can use <code>connectivity_pw = PointerWrapper(connectivity)</code> to obtain a wrapped version of the pointer, where the underlying data can be accessed simply by <code>connectivity_pw.num_trees[]</code> without the need to call <code>unsafe_load</code> manually. This works even for nested structures, e.g, where the named field of a <code>struct</code> is a pointer to a <code>struct</code>. A full example on how to use the <code>PointerWrapper</code> is given here (note the nested access at <code>p4est_pw.connectivity.num_trees[]</code> compared to <code>unsafe_load(unsafe_load(p4est).connectivity).num_trees</code> without a <code>PointerWrapper</code>):</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using P4est, MPI; MPI.Init()</code><code class="nohighlight hljs ansi" style="display:block;">MPI.ThreadLevel(2)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity = p4est_connectivity_new_periodic()</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{p4est_connectivity} @0x000000000463a780</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_pw = PointerWrapper(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;">PointerWrapper{p4est_connectivity}(Ptr{p4est_connectivity} @0x000000000463a780)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_pw.num_trees[]</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 0, true, 0, C_NULL, C_NULL)</code><code class="nohighlight hljs ansi" style="display:block;">Into p4est_new with min quadrants 0 level 0 uniform 1
New p4est with 1 trees on 1 processors
Initial level 0 potential global quadrants 1 per tree 1
Done p4est_new with 1 total quadrants
Ptr{P4est.LibP4est.p4est} @0x00000000050f8e40</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw = PointerWrapper(p4est)</code><code class="nohighlight hljs ansi" style="display:block;">PointerWrapper{P4est.LibP4est.p4est}(Ptr{P4est.LibP4est.p4est} @0x00000000050f8e40)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw.connectivity.num_trees[]</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_connectivity_destroy(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_destroy(p4est)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>In addition, you can use a <code>PointerWrapper</code> as an array if the underlying datastructure is an array, i.e. you can access the <code>i</code>-th element of the underlying array by <code>pw[i]</code> for a <code>PointerWrapper</code> <code>pw</code>. See the following code for a full example:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using P4est, MPI; MPI.Init()</code><code class="nohighlight hljs ansi" style="display:block;">MPI.ThreadLevel(2)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity = p4est_connectivity_new_periodic()</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{p4est_connectivity} @0x000000000463a780</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 0, true, 0, C_NULL, C_NULL)</code><code class="nohighlight hljs ansi" style="display:block;">Into p4est_new with min quadrants 0 level 0 uniform 1
New p4est with 1 trees on 1 processors
Initial level 0 potential global quadrants 1 per tree 1
Done p4est_new with 1 total quadrants
Ptr{P4est.LibP4est.p4est} @0x00000000017fa170</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw = PointerWrapper(p4est)</code><code class="nohighlight hljs ansi" style="display:block;">PointerWrapper{P4est.LibP4est.p4est}(Ptr{P4est.LibP4est.p4est} @0x00000000017fa170)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw.global_first_quadrant[2]</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_connectivity_destroy(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_destroy(p4est)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h3 id="Note-on-MPI-datatypes"><a class="docs-heading-anchor" href="#Note-on-MPI-datatypes">Note on MPI datatypes</a><a id="Note-on-MPI-datatypes-1"></a><a class="docs-heading-anchor-permalink" href="#Note-on-MPI-datatypes" title="Permalink"></a></h3><p>MPI types used by <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> are mapped to the types provided by <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a>.</p><table><tr><th style="text-align: left"><a href="https://github.com/cburstedde/p4est"><code>p4est</code></a></th><th style="text-align: left"><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a></th></tr><tr><td style="text-align: left"><code>sc_MPI_Comm</code></td><td style="text-align: left"><code>MPI.MPI_Comm</code></td></tr><tr><td style="text-align: left"><code>MPI_Datatype</code></td><td style="text-align: left"><code>MPI.MPI_Datatype</code></td></tr><tr><td style="text-align: left"><code>MPI_File</code></td><td style="text-align: left"><code>MPI.MPI_File</code></td></tr></table><p>In particular, it is currently not possible to use <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> without MPI support.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../reference/">API reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 23 March 2023 07:15">Thursday 23 March 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
