<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Introduction · P4est.jl</title><meta name="title" content="Introduction · P4est.jl"/><meta property="og:title" content="Introduction · P4est.jl"/><meta property="twitter:title" content="Introduction · P4est.jl"/><meta name="description" content="Documentation for P4est.jl."/><meta property="og:description" content="Documentation for P4est.jl."/><meta property="twitter:description" content="Documentation for P4est.jl."/><meta property="og:url" content="https://trixi-framework.github.io/P4est.jl/stable/introduction/"/><meta property="twitter:url" content="https://trixi-framework.github.io/P4est.jl/stable/introduction/"/><link rel="canonical" href="https://trixi-framework.github.io/P4est.jl/stable/introduction/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">P4est.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Introduction</a><ul class="internal"><li><a class="tocitem" href="#High-level-overview-of-the-setup"><span>High-level overview of the setup</span></a></li><li><a class="tocitem" href="#translation_guidelines"><span>Translation guidelines</span></a></li><li><a class="tocitem" href="#pointer_wrappers"><span><code>PointerWrapper</code>s</span></a></li></ul></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting and FAQ</a></li><li><a class="tocitem" href="../reference/">API reference</a></li><li><a class="tocitem" href="../authors/">Authors</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../code_of_conduct/">Code of conduct</a></li><li><a class="tocitem" href="../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Introduction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Introduction</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/trixi-framework/P4est.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/trixi-framework/P4est.jl/blob/main/docs/src/introduction.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h1><p>Installation instructions and first usage examples are shown on the <a href="../#P4est.jl">main page</a>. This page collects some additional examples and translation guidelines from the C library <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> to its Julia wrapper <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a>.</p><h2 id="High-level-overview-of-the-setup"><a class="docs-heading-anchor" href="#High-level-overview-of-the-setup">High-level overview of the setup</a><a id="High-level-overview-of-the-setup-1"></a><a class="docs-heading-anchor-permalink" href="#High-level-overview-of-the-setup" title="Permalink"></a></h2><p>The Julia bindings of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> are generated using <a href="https://github.com/JuliaInterop/Clang.jl">Clang.jl</a>. This process is described in the <a href="https://github.com/trixi-framework/P4est.jl/tree/main/dev"><code>dev</code></a> folder of <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a>. Since all MPI datatypes are mapped to types from MPI.jl, the generated bindings are agnostic of the local MPI installation. Hence, there should be no need to generate new bindings as a user. If there are problems, please let us know, e.g., by <a href="https://github.com/trixi-framework/P4est.jl/issues/new">creating on issue</a> on GitHub. New bindings only need to be generated for a new version of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> that comes with a different API. We will probably provide some new bindings when we learn about this.</p><h2 id="translation_guidelines"><a class="docs-heading-anchor" href="#translation_guidelines">Translation guidelines</a><a id="translation_guidelines-1"></a><a class="docs-heading-anchor-permalink" href="#translation_guidelines" title="Permalink"></a></h2><p>Many functions of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> work with pointers, e.g.,</p><pre><code class="language-C hljs">int p4est_connectivity_is_valid (p4est_connectivity_t * connectivity);</code></pre><p>or return pointers to newly created <code>struct</code>s, e.g.,</p><pre><code class="language-C hljs">p4est_connectivity_t *p4est_connectivity_new_periodic (void);</code></pre><p><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> wraps these C functions accordingly and works with pointers. For a convenient alternative to using raw pointers directly, see the next section on <a href="#pointer_wrappers"><code>PointerWrapper</code>s</a>. We also follow the naming scheme of <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a>. For example, we use <code>connectivity::Ptr{p4est_connectivity}</code>. However, it is sometimes useful/required to also load the wrappers of the C <code>struct</code>s from their pointers. In this case, we use the naming convention to append <code>_obj</code>, e.g., <code>connectivity_obj = unsafe_load(connectivity)</code>. A full example is given here:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using P4est, MPI; MPI.Init()</code><code class="nohighlight hljs ansi" style="display:block;">MPI.ThreadLevel(2)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity = p4est_connectivity_new_periodic()</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{p4est_connectivity} @0x00000000038a4060</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @doc(p4est_connectivity)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr36">  p4est_connectivity</span>

  This structure holds the 2D inter-tree connectivity information.
  Identification of arbitrary faces and corners is possible.

  The arrays tree_to_* are stored in z ordering. For corners the order wrt. yx
  is 00 01 10 11. For faces the order is -x +x -y +y. They are allocated
  [0][0]..[0][3]..[num_trees-1][0]..[num_trees-1][3].

  The values for tree_to_face are 0..7 where ttf % 4 gives the face number and
  ttf / 4 the face orientation code. The orientation is 0 for edges that are
  aligned in z-order, and 1 for edges that are running opposite in z-order.

  It is valid to specify num_vertices as 0. In this case vertices and
  tree_to_vertex are set to NULL. Otherwise the vertex coordinates are stored
  in the array vertices as
  [0][0]..[0][2]..[num_vertices-1][0]..[num_vertices-1][2].

  The corners are only stored when they connect trees. In this case
  tree_to_corner indexes into <span class="sgr4">ctt_offset</span>. Otherwise the tree_to_corner entry
  must be -1 and this corner is ignored. If num_corners == 0, tree_to_corner
  and corner_to_* arrays are set to NULL.

  The arrays corner_to_* store a variable number of entries per corner. For
  corner c these are at position [ctt_offset[c]]..[ctt_offset[c+1]-1]. Their
  number for corner c is ctt_offset[c+1] - ctt_offset[c]. The entries encode
  all trees adjacent to corner c. The size of the corner_to_* arrays is
  num_ctt = ctt_offset[num_corners].

  The *_to_attr arrays may have arbitrary contents defined by the user.

  Field            Note
  –––––––––––––––– –––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
  num_vertices     the number of vertices that define the <span class="sgr4">embedding</span> of the forest (not the topology)
  num_trees        the number of trees
  num_corners      the number of corners that help define topology
  vertices         an array of size (3 * <span class="sgr4">num_vertices</span>)
  tree_to_vertex   embed each tree into <span class="sgr36">c++ R^3</span> for e.g. visualization (see p4est_vtk.h)
  tree_attr_bytes  bytes per tree in tree_to_attr
  tree_to_attr     not touched by <span class="sgr36">p4est</span>
  tree_to_tree     (4 * <span class="sgr4">num_trees</span>) neighbors across faces
  tree_to_face     (4 * <span class="sgr4">num_trees</span>) face to face+orientation (see description)
  tree_to_corner   (4 * <span class="sgr4">num_trees</span>) or NULL (see description)
  ctt_offset       corner to offset in <span class="sgr4">cornerto</span>tree and <span class="sgr4">cornerto</span>corner
  corner_to_tree   list of trees that meet at a corner
  corner_to_corner list of tree-corners that meet at a corner</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_obj = unsafe_load(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;">p4est_connectivity(4, 1, 1, Ptr{Float64} @0x000000000392c5e0, Ptr{Int32} @0x0000000002ad9750, 0x0000000000000000, Cstring(0x0000000000000000), Ptr{Int32} @0x00000000026d1f50, Ptr{Int8} @0x0000000002a2f600, Ptr{Int32} @0x0000000001d09d50, Ptr{Int32} @0x0000000002a7c3d0, Ptr{Int32} @0x00000000025f3030, Ptr{Int8} @0x0000000002dd6ff0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_obj.num_vertices</code><code class="nohighlight hljs ansi" style="display:block;">4</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_obj.num_trees</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_obj.num_corners</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_connectivity_destroy(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h2 id="pointer_wrappers"><a class="docs-heading-anchor" href="#pointer_wrappers"><code>PointerWrapper</code>s</a><a id="pointer_wrappers-1"></a><a class="docs-heading-anchor-permalink" href="#pointer_wrappers" title="Permalink"></a></h2><p>As we have seen in the previous section on <a href="#translation_guidelines">translation guidelines</a>, many functions provided by <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> return pointers to <code>struct</code>s, which requires one to <a href="https://docs.julialang.org/en/v1/base/c/#Base.unsafe_load"><code>unsafe_load</code></a> the pointer in order to access the underlying data. <a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a> offers a convenient alternative to directly using <code>unsafe_load</code> by providing the <a href="../reference/#P4est.PointerWrappers.PointerWrapper"><code>PointerWrapper</code></a> data type. If you, e.g., have a pointer to a <code>p4est_connectivity</code> (i.e., an object of type <code>Ptr{p4est_connectivity}</code>) called <code>connectivity</code>, you can use <code>connectivity_pw = PointerWrapper(connectivity)</code> to obtain a wrapped version of the pointer, where the underlying data can be accessed simply by <code>connectivity_pw.num_trees[]</code> without the need to call <code>unsafe_load</code> manually. This works even for nested structures, e.g, where the named field of a <code>struct</code> is a pointer to a <code>struct</code>. A full example on how to use the <code>PointerWrapper</code> is given here (note the nested access at <code>p4est_pw.connectivity.num_trees[]</code> compared to <code>unsafe_load(unsafe_load(p4est).connectivity).num_trees</code> without a <code>PointerWrapper</code>):</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using P4est, MPI; MPI.Init()</code><code class="nohighlight hljs ansi" style="display:block;">MPI.ThreadLevel(2)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity = p4est_connectivity_new_periodic()</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{p4est_connectivity} @0x0000000002cb68e0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_pw = PointerWrapper(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;">PointerWrapper{p4est_connectivity}(Ptr{p4est_connectivity} @0x0000000002cb68e0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity_pw.num_trees[]</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 0, true, 0, C_NULL, C_NULL)</code><code class="nohighlight hljs ansi" style="display:block;">Into p4est_new with min quadrants 0 level 0 uniform 1
New p4est with 1 trees on 1 processors
Initial level 0 potential global quadrants 1 per tree 1
Done p4est_new with 1 total quadrants
Ptr{P4est.LibP4est.p4est} @0x000000000281bb70</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw = PointerWrapper(p4est)</code><code class="nohighlight hljs ansi" style="display:block;">PointerWrapper{P4est.LibP4est.p4est}(Ptr{P4est.LibP4est.p4est} @0x000000000281bb70)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw.connectivity.num_trees[]</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_destroy(p4est)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_connectivity_destroy(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>You may also use the <code>PointerWrapper</code> to set variables in <code>struct</code>s.  Here we set the user data pointer in the <code>p4est_t</code> <code>struct</code> to point to some data:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using P4est, MPI; MPI.Init()</code><code class="nohighlight hljs ansi" style="display:block;">MPI.ThreadLevel(2)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity = p4est_connectivity_new_periodic()</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{p4est_connectivity} @0x0000000003599470</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 0, true, 0, C_NULL, C_NULL)</code><code class="nohighlight hljs ansi" style="display:block;">Into p4est_new with min quadrants 0 level 0 uniform 1
New p4est with 1 trees on 1 processors
Initial level 0 potential global quadrants 1 per tree 1
Done p4est_new with 1 total quadrants
Ptr{P4est.LibP4est.p4est} @0x0000000002bf28b0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw = PointerWrapper(p4est)</code><code class="nohighlight hljs ansi" style="display:block;">PointerWrapper{P4est.LibP4est.p4est}(Ptr{P4est.LibP4est.p4est} @0x0000000002bf28b0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; data = Ref((rand(4), rand(5)))</code><code class="nohighlight hljs ansi" style="display:block;">Base.RefValue{Tuple{Vector{Float64}, Vector{Float64}}}(([0.9563143700262997, 0.16619213386036424, 0.7944128972383298, 0.9264181925787428], [0.750243785467092, 0.7525164883579533, 0.5929672400982664, 0.9314917147561163, 0.6349109946176067]))</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; GC.@preserve data begin
           p4est_pw.user_pointer = pointer_from_objref(data)
       
           # Call p4est function with callback that uses p4est_pw.user_pointer here.
           # You may retrieve the data `Ref` in the callback with
           # data = unsafe_pointer_to_objref(pointer(p4est_pw.user_pointer))
       end</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{Nothing} @0x00007f8c8c044390</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_destroy(p4est)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_connectivity_destroy(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>In addition, you can use a <code>PointerWrapper</code> as an array if the underlying datastructure is an array, i.e. you can access the <code>i</code>-th element of the underlying array by <code>pw[i]</code> for a <code>PointerWrapper</code> <code>pw</code>. See the following code for a full example:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using P4est, MPI; MPI.Init()</code><code class="nohighlight hljs ansi" style="display:block;">MPI.ThreadLevel(2)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; connectivity = p4est_connectivity_new_periodic()</code><code class="nohighlight hljs ansi" style="display:block;">Ptr{p4est_connectivity} @0x000000000226bfe0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est = p4est_new_ext(MPI.COMM_WORLD, connectivity, 0, 0, true, 0, C_NULL, C_NULL)</code><code class="nohighlight hljs ansi" style="display:block;">Into p4est_new with min quadrants 0 level 0 uniform 1
New p4est with 1 trees on 1 processors
Initial level 0 potential global quadrants 1 per tree 1
Done p4est_new with 1 total quadrants
Ptr{P4est.LibP4est.p4est} @0x00000000026cf1d0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw = PointerWrapper(p4est)</code><code class="nohighlight hljs ansi" style="display:block;">PointerWrapper{P4est.LibP4est.p4est}(Ptr{P4est.LibP4est.p4est} @0x00000000026cf1d0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_pw.global_first_quadrant[2]</code><code class="nohighlight hljs ansi" style="display:block;">1</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_destroy(p4est)</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p4est_connectivity_destroy(connectivity)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h3 id="Note-on-MPI-datatypes"><a class="docs-heading-anchor" href="#Note-on-MPI-datatypes">Note on MPI datatypes</a><a id="Note-on-MPI-datatypes-1"></a><a class="docs-heading-anchor-permalink" href="#Note-on-MPI-datatypes" title="Permalink"></a></h3><p>MPI types used by <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> are mapped to the types provided by <a href="https://github.com/JuliaParallel/MPI.jl">MPI.jl</a>.</p><table><tr><th style="text-align: left"><a href="https://github.com/cburstedde/p4est"><code>p4est</code></a></th><th style="text-align: left"><a href="https://github.com/trixi-framework/P4est.jl">P4est.jl</a></th></tr><tr><td style="text-align: left"><code>sc_MPI_Comm</code></td><td style="text-align: left"><code>MPI.MPI_Comm</code></td></tr><tr><td style="text-align: left"><code>MPI_Datatype</code></td><td style="text-align: left"><code>MPI.MPI_Datatype</code></td></tr><tr><td style="text-align: left"><code>MPI_File</code></td><td style="text-align: left"><code>MPI.MPI_File</code></td></tr></table><p>In particular, it is currently not possible to use <a href="https://github.com/cburstedde/p4est"><code>p4est</code></a> without MPI support.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../troubleshooting/">Troubleshooting and FAQ »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Thursday 28 March 2024 10:31">Thursday 28 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
